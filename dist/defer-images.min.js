/*
defer-images
version: 1.0.0
compiled: 2015-02-04
David Morrow
*/
!function(){"use strict";window.defer={debugInfo:[],showConsole:!0,trace:function(obj,type){return void 0!==window.console&&this.showConsole?(type=type||"log",void console[type](obj)):void this.debugInfo.push(obj)}},window.defer.images={observer:!1,imgs:[],listening:!1,allRegistered:!1,lastScrollPos:0,scrollDir:"down",className:"defer",scrollDelay:200,counts:{lastInView:0,loading:0},start:function(el){if(void 0!==window.MutationObserver){var observer=new MutationObserver(function(mutations){mutations.forEach(function(mutation){defer.images.findImgs(mutation.addedNodes)})});observer.observe(el,{attributes:!0,childList:!0,characterData:!1,subTree:!0,attributeFilter:["class"]})}},findImgs:function(nodes){var i,node;for(i=0;i<nodes.length;i+=1)node=nodes[i],node.childNodes.length>0&&defer.images.findImgs(node.childNodes),node.classList&&node.classList.contains(defer.images.className)&&defer.images.add(node)},done:function(){this.observer&&this.observer.disconnect(),this.allRegistered=!0},add:function(el){el.defer={src:el.getAttribute("data-src"),loaded:!1,loading:!1},this.imgs.push(el),this.listen(),(this.inView(el)||1===this.imgs.length)&&this.loadImg(el)},listen:function(){this.listening||(this.listening=!0,this.viewPort=setInterval(function(){defer.images.recordScroll()&&defer.images.checkAll()},this.scrollDelay),defer.bg.listen())},destroy:function(){defer.trace("destroyed"),clearInterval(this.viewPort),defer.bg.destroy(),this.imgs=[],delete this.imgs,delete window.deferImages},imgLoaded:function(event){var el=event.srcElement;el.className="loaded",this.loading-=1,defer.trace("#"+el.defer.src+" loaded"),el.onload=null,el.defer.loaded=!0,defer.bg.loadTimes.push((new Date).getTime()-el.defer.loadStart),this.removeLoaded(),defer.trace(this.imgs.length+" remaining")},loadImg:function(el){this.loading+=1,defer.trace("#"+el.defer.src+" requested"),el.onload=function(event){defer.images.imgLoaded(event)},el.src=el.defer.src,el.defer.loading=!0,el.defer.loadStart=(new Date).getTime()},removeLoaded:function(){var i,tmp=[];for(i=0;i<this.imgs.length;i+=1)this.imgs[i].defer.loaded?delete this.imgs[i].defer:tmp.push(this.imgs[i]);this.imgs=tmp},checkAll:function(){this.allRegistered&&0===this.imgs&&(deferBg.destroy(),this.destroy());var el,i=0;for(i;i<this.imgs.length;i+=1)el=this.imgs[i],this.inView(el)&&!el.defer.loading&&this.loadImg(el)},recordScroll:function(){var supportPageOffset=void 0!==window.pageXOffset,isCSS1Compat="CSS1Compat"===(document.compatMode||""),y=supportPageOffset?window.pageYOffset:isCSS1Compat?document.documentElement.scrollTop:document.body.scrollTop;return this.lastScrollPos===y?!1:(this.scrollDir=y>this.lastScrollPos?"down":"up",this.lastScrollPos=y,defer.trace("scrolling "+this.scrollDir),!0)},inView:function(el){var box=el.getBoundingClientRect(),bottom=window.innerHeight||document.documentElement.clientHeight;return this.counts.lastInView=el.defer.index,box.bottom>=0&&box.top<=bottom}}}(),function(){"use strict";window.defer.bg={loadTimes:[],bgDelay:300,bg:null,enabled:!0,d:null,listen:function(){this.enabled&&(this.d=defer.images,this.bg=setInterval(function(){defer.bg.guessNext()},this.bgDelay))},guessNext:function(){if(!(this.d.allRegistered&&0===this.d.imgs.length||0!==this.d.counts.loading)){defer.trace("guess next called "+this.d.scrollDir);var el,i=this.d.counts.lastInView;if("up"===this.d.scrollDir)for(;i>=0;){if(el=this.d.imgs[i],el&&!el.defer.loading){this.d.loadImg(el);break}i-=1}else for(;i<this.d.imgs.length;){if(el=this.d.imgs[i],el&&!el.defer.loading){this.d.loadImg(el);break}i+=1}}},destroy:function(){clearInterval(this.bg)}}}(),function(){"use strict";window.defer.dom={watchDom:function(){},getScrollY:function(){}}}();
//# sourceMappingURL=defer-images.min.js.map